<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Peer-to-Peer Compute Cluster via Futureverse • future.p2p</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="A Peer-to-Peer Compute Cluster via Futureverse">
<meta property="og:description" content="Implementation of the Future API &lt;doi:10.32614/RJ-2021-048&gt; that resolves futures on a peer-to-peer (P2P) compute environment. By using this future backend, you and your friends can share your spare compute resources with each other.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">future.p2p</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/future.p2p-10-getting-started.html">future.p2p: Getting Started</a>
    </li>
    <li>
      <a href="articles/future.p2p-20-personal-cluster.html">future.p2p: A Personal P2P Cluster</a>
    </li>
    <li>
      <a href="articles/future.p2p-30-shared-cluster.html">future.p2p: A Shared P2P Cluster among Friends</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="futurep2p---a-peer-to-peer-compute-cluster-via-futureverse">future.p2p - A Peer-to-Peer Compute Cluster via Futureverse<a class="anchor" aria-label="anchor" href="#futurep2p---a-peer-to-peer-compute-cluster-via-futureverse"></a>
</h1></div>
<p><em>- Share R compute among friends across the world</em></p>
<div class="section level2">
<h2 id="tldr">TL;DR<a class="anchor" aria-label="anchor" href="#tldr"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Resolve futures via a P2P cluster shared among friends</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.p2p</span><span class="fu">::</span><span class="va"><a href="reference/cluster.html">cluster</a></span>, cluster <span class="op">=</span> <span class="st">"alice/friends"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create future</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://future.futureverse.org/reference/future.html" class="external-link">future</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co">## Get results</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://future.futureverse.org/reference/value.html" class="external-link">value</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"futureverse/future.p2p"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>In order to join a future P2P cluster, you must:</p>
<ol style="list-style-type: decimal">
<li><p>have an <em>SSH key pair</em> configured, and</p></li>
<li><p>have a <em><a href="https://pico.sh/" class="external-link">pico.sh</a> account</em>.</p></li>
</ol>
<p>See the ‘Getting Started’ vignette for how to set this up, but the gist for creating an SSH key pair if you already don’t have one is to:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> mkdir ~/.ssh/</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">$</span> chmod 0700 ~/.ssh/</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="ex">$</span> ssh-keygen</span></code></pre></div>
<p>With the key pair create a <a href="https://pico.sh/" class="external-link">pico.sh</a> account by logging into their server:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> ssh pico.sh</span></code></pre></div>
<p>Choose your pico.sh username, which will also be your P2P cluster username, and click <kbd>ENTER</kbd>. Finally, verify SSH access to <code>pipe.pico.sh</code> (sic!);</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> ssh pipe.pico.sh</span></code></pre></div>
<p>That’s it!</p>
</div>
<div class="section level2">
<h2 id="set-up-a-shared-p2p-cluster">Set up a shared P2P cluster<a class="anchor" aria-label="anchor" href="#set-up-a-shared-p2p-cluster"></a>
</h2>
<p>Let’s assume P2P users ‘alice’, ‘bob’, ‘carol’, and ‘diana’ decides to share a P2P cluster and user ‘alice’ agrees to host it. Hosting a P2P cluster only means that you control who has access - there’s no extra load added. So, to host, ‘alice’ calls:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">{alice}$</span> Rscript <span class="at">-e</span> future.p2p::host_cluster <span class="at">--users</span><span class="op">=</span>bob,carol,diana <span class="at">--cluster</span><span class="op">=</span>alice/friends</span></code></pre></div>
<p>A future P2P cluster can be hosted from anywhere in the world, and it does not have to on a machine where you run your own R analysis.</p>
</div>
<div class="section level2">
<h2 id="parallelize-via-p2p-cluster-all-users">Parallelize via P2P cluster (all users)<a class="anchor" aria-label="anchor" href="#parallelize-via-p2p-cluster-all-users"></a>
</h2>
<p>Any user with access to the ‘alice/friends’ cluster can use it. In our example, this means ‘bob’, ‘carol’, ‘diana’, and ‘alice’ may use the P2P cluster at the same time. Just like with any other future backend, we use <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan()</a></code> to specifying that we want to parallelize via the P2P cluster.</p>
<p>For example,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future.p2p</span><span class="fu">::</span><span class="va"><a href="reference/cluster.html">cluster</a></span>, cluster <span class="op">=</span> <span class="st">"alice/friends"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Evaluate a R expression via the P2P cluster</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://future.futureverse.org/reference/future.html" class="external-link">future</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getpid.html" class="external-link">Sys.getpid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Retrieve value</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://future.futureverse.org/reference/value.html" class="external-link">value</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="share-your-compute-power-with-your-friends-any-user">Share your compute power with your friends (any user)<a class="anchor" aria-label="anchor" href="#share-your-compute-power-with-your-friends-any-user"></a>
</h2>
<p>Without parallel workers, the P2P cluster is useless and will not process any parallel tasks. This is where the peer-to-peer concept comes in, where we contribute our idle compute cycles to the cluster for others to make use of. To contribute your R compute power to the <code>alice/friends</code> cluster, launch a P2P worker as:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">{bob}$</span> Rscript <span class="at">-e</span> future.p2p::worker <span class="at">--cluster</span><span class="op">=</span>alice/friends</span></code></pre></div>
<p>This will contribute one parallel worker to the p2p cluster. You can contribute additional ones by repeating the same command one or more times.</p>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="section level3">
<h3 id="connecting-to-the-same-picosh-account-from-different-machines">Connecting to the same pico.sh account from different machines<a class="anchor" aria-label="anchor" href="#connecting-to-the-same-picosh-account-from-different-machines"></a>
</h3>
<p>If you have multiple computers, you can add your public SSH keys for those as well by logging in again by calling <code>ssh pico.sh</code>. Then go to the <code>pubkeys</code> menu, where you have options to add additional <em>public SSH keys</em> of yours. This way, you can use your pico.sh account from multiple computer systems, which can be handy if you want to set up parallel workers on one system and harness their compute power from another.</p>
</div>
<div class="section level3">
<h3 id="set-up-a-worker-to-connect-to-picosh-via-a-jumphost">Set up a worker to connect to pico.sh via a jumphost<a class="anchor" aria-label="anchor" href="#set-up-a-worker-to-connect-to-picosh-via-a-jumphost"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">{bob}$</span> Rscript <span class="at">-e</span> future.p2p::worker <span class="at">--ssh_args</span><span class="op">=</span><span class="st">"-J somehost"</span> <span class="at">--cluster</span><span class="op">=</span>alice/friends</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="troubleshoot-wormhole">Troubleshoot Wormhole<a class="anchor" aria-label="anchor" href="#troubleshoot-wormhole"></a>
</h3>
<p>If you are behind a firewall with a proxy, wormhole might fail to establish an outbound connection. For example, if you try:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">system2</span>(future.p2p<span class="sc">::</span><span class="fu">find_wormhole</span>(), <span class="at">args =</span> <span class="fu">c</span>(<span class="st">"send"</span>, <span class="st">"--text"</span>, <span class="st">"hello"</span>))</span></code></pre></div>
<p>it might stall forever. If that happens, press <kbd>Ctrl-C</kbd> to interrupt and retry by disabling the proxy settings using:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="op">&gt;</span> Sys.unsetenv<span class="kw">(</span><span class="st">"http_proxy"</span><span class="kw">)</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="op">&gt;</span> system2<span class="kw">(</span><span class="fu">future.p2p::find_wormhole()</span><span class="ex">,</span> args = c<span class="er">(</span><span class="st">"send"</span><span class="ex">,</span> <span class="st">"--text"</span>, <span class="st">"hello"</span><span class="kw">))</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="ex">On</span> the other computer, please run: wormhole receive <span class="er">(</span><span class="ex">or</span> wormhole-william recv<span class="kw">)</span>                                                       </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="ex">Wormhole</span> code is: 53-visitor-physique</span></code></pre></div>
<p>If the latter works for you, launch R by unsetting environment variable <code>http_proxy</code>, e.g.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">{bob}$</span> http_proxy=<span class="st">""</span> Rscript <span class="at">-e</span> future.p2p::worker <span class="at">--cluster</span><span class="op">=</span>alice/friends</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 3)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing future.p2p</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Henrik Bengtsson <br><small class="roles"> Author, maintainer, copyright holder </small>   </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Henrik Bengtsson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3</p> and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9007.</p>
</div>

      </footer>
</div>






  </body>
</html>
